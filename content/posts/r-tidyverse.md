---
title: "数分 | R 语言的 Tidyverse 数据分析体系"
date: 2022-02-27T10:55:07+08:00
categories: [数据流水线]
tags:
  - r
  - tidyverse
---

<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:-webkit-fill-available; height:400px;" src="https://www.processon.com/embed/5a6054c2e4b010a6e72203f3"></iframe>

## 前言：坚持下来了吔

值得一说的是，[@Hadley Wickham](https://hadley.nz/) 的这本 [《R for Data Science》](http://r4ds.had.co.nz/) 的阅读是以微信打卡的方式完成的，这给了我十分新奇的体验。之前看一些技术类书籍，经常容易浅尝辄止、半途而废，在工作之后只能晚上抽空阅读的情形下能坚持下来更是变得愈发艰难。幸运的是，以前我一直觉得对我无效的打卡方式这次发挥了巨大的功效——它不仅让我坚持了下来，还让我更加专心与聚焦，同时也没有产生过多的畏难情绪。从 22 年初到 2 月底两个月的时间里，一切都很顺利地推进了下来 🙏。

回想一下，有两个不可或缺的部分对本次阅读进程赋予了前行的助力：

1. 找一个在乎的人，把在做的去告诉祂吧！  
   打卡这件事儿，无论是 Todo List 上自己的默默打卡，还是社交软件小组中的组团打卡，亦或是某些软件的交钱返现打卡，这些尝试我都无一例外地失败了。究其原因，常是因为我对这些东西本身的粘性就不强，如果不是特别的理由的话，我在闲暇时根本不会去打开它们，这样子一旦断签我就可能遗忘，因为它们本就是可有可无的，消失了也不会觉得有什么不一样。但微信不一样，无事之时我总会一遍一遍反复地打开微信，把阅读打卡和与杨同志聊天这么令人开心可以每天进行都不腻的事绑定起来怎么会断签、会遗忘呢~ 😊
2. 留下一些可见的想法与记录，实打实的东西会给予安全感。  
   在这里我不想谈什么输出倒逼输入的大道理，我只想说一下在这次学习进程中我的那些记录到底帮助我度过了哪些难关。
   - 首先，无论是工作上的紧急事务的侵扰、还是身体状况的不支，亦或春节需要纵情享乐的需求都会让打卡事业产生中断，妄图去幻想打卡永远平稳进行这件事于我看来是极不靠谱的，但因为我习惯于总结与记录，所以我能很快的过一遍我看过的内容，这样子就算再忙也可以花上一两分钟去保持阅读的感觉不会中断，再拾起时也不至于因要从头再来而产生畏难以致放弃。
   - 另一方面，零碎的记录，每章的总结对于最终的复习及收束总结大有裨益，如果奢望一切都记在脑子里，最终看完整本书再去写出一些东西，那对我来说太难了，一切都还是那么散，让人抓不到脉络的感觉会直接让我放弃；这样子的话，经些岁月，书中的内容也就忘得差不多了，不至于说白读了，总会觉得有些可惜，总归是种不好的感受。我这次就是每次打卡，想写点儿东西时就简单附上一两句，同时每一部分看完都会根据内容形式选择顺手的记录方式去总结一下，最后看完书根据这些想法与记录，先在脑海中串一下，再用笔将脑海中的大纲在一张白纸上徐徐画出，再利用电脑软件的便利性与丰富性结合思路形式和书中内容有机组合，就形成了上方链接中的流程图。最后的最后，这一切完成之后怎么会忍心不写下这篇文章来纪念一下呢 🤗。

## 三维视角析数据处理

为了更好地了解如何去操纵数据，首要的事儿肯定是先去了解数据对象如何构成以及有哪些基础的行为可以应用在这些数据对象身上。本书对 R 中主要的数据结构进行了系统而富有逻辑的讲解，`Atomic Vectors`、`Recursive Vectors`、`Augmented Vectors` 一路娓娓道来，让我首次对平日里每日里处理的 R 数据第一次有了较为清晰明白的认知，辅以对 `pipe`、`functions`、`iteration` 的介绍对「R 是一门向量化与函数化的语言」这句话有了更深刻切身的认知。了解这些基础内容之后，更进一步也更加具体的场景中大多是对矩形数据进行处理。

书读罢，在我看来对于矩形数据的处理主要从三部分入手，分别是 `元素`、`行列`和`表格`，三者因数据本身所代表的内涵与关注点不同，带来的思考维度也就不同，主要进行的操作随之转变。

- **元素**  
  不难理解，对于元素 —— 即表格中行列相交的每一个点值而言，最主要的操作就是数据格式的处理，这方面比较典型且难处理的有文本型、因子型和时间型三种。其中不管在任何语言中文本型数据的处理都是一门学问，这方面各种操作有很多，我认为在掌握基础操作的基础上去认真了解并学习 **正则表达式** 不失为一种对文本数据处理的较为通行的解决方案，不单单是在这里 R 中的数据处理部分，相信在任何涉及文本处理的领域它都会成为你的得力伙伴；时间型数据处理方面，像时区、写法等注意点有很多，但让我眼前一亮的是文中对时刻（`date\time\datetime`）与时间间隔（`durations\periods\intervals`）的释义与处理，这种对时间数据的划分与理解方式是很值得学习与总结的部分，体现了时间数据处理中的本质所在与逻辑性脉络，读罢后再对时间进行处理时脑海中自然也就有了章法，不至于两眼一摸黑。
- **行列**  
  如果说对元素的处理更像是对某个或某些值进行清洗，那么对行列的处理就要升一个维度，无论是对观测行进行筛选与排序、变量列进行选择与重算，还是进行分组、汇总等操作都不再是去思考某个值会变为怎样怎样，而是以整行整列的某个或某些向量的角度去思考问题，某些行/列会变为这样那样，除了以上的操作之外行列之间的拆分（`unite\separate`）、转换（`wider\longer`）也都是很有启发性的内容。这一部分的操作都是在对数据进行分析过程中最具思考性及创造性的部分，机器学习领域常说的 **特征处理** 也一般集中在这一部分。
- **表格**  
  涉及到表格层面的操作主要是多个数据表之间的数据如何互通，实现联结。对于行列以及表格这两部分的内容，如果学过 SQL 的同学肯定会感到十分熟悉与亲切，毕竟都是对矩形数据进行处理，底层的思考方式与操作逻辑也会趋向于同质。这两部分我倒觉得由于底层逻辑是相通的，可以采取对照学习的方法，将 Excel、SQL、R 与 Python 对矩形数据的操作处理进行 **类比学习**，体会不同的语言特性与展示逻辑，触类旁通的同时又能加深理解！

## 图层语法观统计绘图

18 年刚接触 R 的时候，我曾经用 RMarkdown 对 R 的绘图系统有写过笔记，并整理在在网站的 [R 包 | 绘图系统综览](../2018-04-07-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96-r-%E7%BB%98%E5%9B%BE%E5%8C%85%E7%B3%BB%E5%88%97/) 一文中，但是限于精力与学识，虽然仅对基础绘图系统做了总结，但那时 `ggplot2` 那整洁系统化而又富有逻辑与拓展性的图层语法就深深的吸引了我，后来在 R 中的作图也基本都是用 `ggplot2` 及其拓展包来完成。如今再读此书，读到可视化一节，不禁感叹身为包作者的 Hadley 对 `ggplot2` 的理解肯定是最深的，闲庭信步间将其骨架拆解开来，读完之后受益颇多。

当然发展到今天，一方面， `ggplot2` 有了很多拓展包，能更加简便的实现更加丰富多彩的可视化效果；另一方面，动态图表、交互式图表在某些领域显示了其相对于静态图表的优越性；同时，数据的可视化常常是一项创造性的工作，不同的展现形式传递出的信息方向与密度大相径庭。总而言之，可视化是门常看常新、需要不断虚心学习的领域，毕竟「**美无止境**」 ^\_^!!

## 后语：一内内想说的

在书中,[@Hadley Wickham](https://hadley.nz/) 向我们完整地展现了在 R 中进行数据的导入、清洗、转换、可视化、建模到报告的全流程。按我自身的观感来说，本书总体上以使用 R 进行数据分析的流程入手，阐释了其作为数据科学家如何去开展并完成一项数据分析工作。技术层面来讲，其中核心且透彻的一部分是对 `tidyverse` 中系列包的介绍 —— 即 **Hadley 本人对数据处理和可视化部分的理念思考，以及这些理念是如何贯彻在在 R 程序与代码中的**。剩下的数据导入、建模和报告的部分内容大致属于补充内容，大都浅浅提及作为介绍，让整个框架更加完善，私以为应该去寻找更加精深的内容去进行探索。

可以将 [BOOKDOWN](https://bookdown.org/) 中的书籍做为一个 R 语言学习的补充列表，当然更进一步最好是去阅读源码，或者付诸实践，用中学，学中做，共勉之！
