---
title: "æ•°ä»“ | å†™å‡ºæ›´å¥½çš„ SQL è¯­å¥"
date: 2022-04-03T16:13:54+08:00
categories: [æ•°æ®åº“æ¼«æ¸¸]
tags:
  - æŠ€æœ¯
  - SQL
  - ç»éªŒä¹‹è°ˆ
---

ğŸ”ˆ æ³¨ï¼šæœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹è¯‘è‡ª Medium ç”¨æˆ· [@Taylor Brownlow](https://taylor-count.medium.com/) çš„[ã€ŠTake Your SQL from Good to Greatã€‹](https://towardsdatascience.com/take-your-sql-from-good-to-great-part-1-3ae61539e92a)ç³»åˆ—æ–‡ç« ã€‚

> ç›¸è¾ƒäº Pythonã€R ç­‰ç¼–ç¨‹è¯­è¨€ï¼ŒSQL è¯­æ³•æ˜¯å¾ˆç®€å•ï¼Œä½†è¦ç²¾é€šäº¦éœ€åŠªåŠ›ã€‚

![sql-cover](https://image-host-1255524710.cos.ap-beijing.myqcloud.com/img/20220403162620.png "SQL is easy until you understand and master it.")

<!--more-->

## 01: æ¸…æ™°è¯­å¥æ‰§è¡Œé¡ºåº[^1]

![sql-æ‰§è¡Œé¡ºåº](https://image-host-1255524710.cos.ap-beijing.myqcloud.com/img/20220405001143.png "Photo by Julia Evans.")

[^1]: [SQL queries don't start with SELECT](https://jvns.ca/blog/2019/10/03/sql-queries-don-t-start-with-select/)

## 02: ç”¨ CTE è¾…åŠ©æŸ¥è¯¢[^2]

[^2]: [Take Your SQL from Good to Great](https://towardsdatascience.com/take-your-sql-from-good-to-great-part-1-3ae61539e92a)

`WITH` è¯­å¥é€šå¸¸è¢«ç§°ä¸ºé€šç”¨è¡¨è¡¨è¾¾å¼ï¼ˆCommon Table Expressionsï¼‰æˆ–è€… CTEsï¼Œä½œä¸ºä¸€ä¸ªè¾…åŠ©è¯­å¥ä¾é™„äºä¸»è¯­å¥ï¼Œ`WITH` è¯­å¥å’Œä¸»è¯­å¥éƒ½å¯ä»¥æ˜¯ `SELECT`ï¼Œ`INSERT`ï¼Œ`UPDATE`ï¼Œ`DELETE` ä¸­çš„ä»»ä½•ä¸€ç§è¯­å¥ã€‚

### CTE åˆ›å»ºè¯­æ³•

> **ä½¿ç”¨æ–¹æ³•:**
>
> - åœ¨ä¸»æŸ¥è¯¢ä¹‹å‰å£°æ˜
> - åœ¨ FROM è¯­å¥ä¸­æŒ‰åç§°å¼•ç”¨ï¼Œå°±åƒå¯¹å¾…æ•°æ®åº“ä¸­çš„å…¶ä»–è¡¨ä¸€æ ·

```sql
WITH cte_name AS (
  CTE_query_definition)

/* æ³¨ï¼šå¯ä»¥åŒæ—¶å®šä¹‰1ä¸ªæˆ–å¤šä¸ªcteï¼Œåšæ³•æ˜¯ç”¨é€—å·','éš”å¼€ï¼Œæœ€åä¸€ä¸ªcteåä¸è·Ÿ',' */
WITH cte_name1 AS (
  CTE_query_definition),
cte_name2 AS (
  CTE_query_definition)
     ...
Main query
```

### CTE çš„ä¼˜åŠ¿

![CTE](https://miro.medium.com/max/1400/1*ubIJsMiJqZxRPEhMTKMjrw.png "Medium-@Taylor Brownlow: Subquery V.S. CTE")

1. **æå‡å¤æ‚æŸ¥è¯¢çš„å¯é˜…è¯»æ€§ã€å¯ç»´æŠ¤æ€§**  
   CTE è®©æˆ‘ä»¬ä»¥ä¸€ç§ç®€å•æ˜“æ‡‚çš„æ–¹å¼æ¥æ„é€ æŸ¥è¯¢ï¼Œè¿™ä¸ä»…ä½¿æˆ‘ä»¬åœ¨`ç¼–å†™æŸ¥è¯¢`æ—¶æ›´åŠ è‡ªç„¶ï¼Œè€Œä¸”ä½¿å…¶ä»–ä»»ä½•éœ€è¦å°è¯•`è§£é‡ŠæŸ¥è¯¢`çš„äººæ›´åŠ æ–¹ä¾¿ã€‚
   - ç¼–å†™è¯­å¥æ—¶æ›´åŠ è‡ªç„¶ï¼Œå°†é—®é¢˜æ¨¡å—åŒ–æ‹†è§£ï¼Œæ›´ç¬¦åˆäººç±»æ€è€ƒæ¨¡å¼
   - ç»“æœéªŒè¯æ—¶æ›´æœ‰é€»è¾‘ï¼Œå¿«é€Ÿå®šä½é—®é¢˜èŠ‚ç‚¹ï¼Œé¿å…å»åå¤æ–­ç‚¹è¯•æ¢
   - ä¿®æ”¹åŠŸèƒ½æ—¶æ›´åŠ å¿«é€Ÿï¼Œä¸“æ³¨å®šä½ç‰¹å®šæ¨¡å—ï¼Œæ— éœ€ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«
2. **ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯æé«˜æ‰§è¡Œæ•ˆç‡**  
   å› ä¸ºè¯­å¥ä¸€ç»æ‰§è¡Œï¼Œä¼šåœ¨æŸ¥è¯¢è¿›ç¨‹ä¸­ä¿æŒæ•°æ®å¤„äºå†…å­˜ä¸­ï¼Œåœ¨éœ€è¦åå¤è°ƒç”¨çš„æƒ…æ™¯ä¸‹ï¼Œæ—¢æ–¹ä¾¿è¿›è¡Œå¤ç”¨ï¼Œåˆå¤§å¤§èŠ‚çœäº†è®¡ç®—èµ„æºï¼Œä½¿æŸ¥è¯¢å¿«é€Ÿé«˜æ•ˆåœ°å®Œæˆã€‚
3. **å¯å¼•ç”¨å…¶ä»–çš„ CTE å¹¶å¯è‡ªå¼•ç”¨**  
   é€šç”¨è¡¨ç”Ÿæˆä¹‹åå’Œæ•°æ®åº“ä¸­çš„è¡¨è¢«ç»Ÿä¸€å¯¹å¾…ï¼Œæ‰€ä»¥å¯¹æ™®é€šè¡¨èƒ½åšçš„æ“ä½œï¼Œé€šç”¨è¡¨ä¹Ÿéƒ½å¯ä»¥å®ç°ï¼Œå¤§å¤§æé«˜äº† SQL è¯­å¥çš„ç”Ÿå‘½åŠ›ä¸çµæ´»æ€§ã€‚

### å»¶ä¼¸é˜…è¯»

- CTE å®˜æ–¹æ–‡æ¡£ï¼š[PostgreSQL](https://www.postgresql.org/docs/9.1/queries-with.html), [BigQuery](https://cloud.google.com/bigquery/docs/reference/standard-sql/query-syntax#with_clause), [Snowflake](https://docs.snowflake.com/en/sql-reference/constructs/with.html), [Redshift](https://docs.aws.amazon.com/redshift/latest/dg/r_WITH_clause.html), [MySQL](https://dev.mysql.com/doc/refman/8.0/en/with.html)

## 03: å­¦ä¼šå¤„ç†æ—¶é—´æ•°æ®

## 04: äº†è§£æ›´å¤šè¿æ¥å½¢å¼

## 05: å–„äºä½¿ç”¨çª—å£å‡½æ•°

---

> **å‚è€ƒæ–‡çŒ®**
>
> - [Four SQL Best Practices Helped me in my SQL Interviews](https://medium.com/@Hong_Tang/four-sql-best-practices-helped-me-in-my-sql-interviews-68e686b6d28a)
